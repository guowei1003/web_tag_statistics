(()=>{"use strict";async function e(e,t){let o;const a=btoa(e.url.split("?")[0]),n=await chrome.storage.local.get([a]);void 0===n[a]?o={url:e.url.split("?")[0],[t]:e.time,updated_at:Date.now(),value:[]}:(o=n[a],o[t]=e.time,o.updated_at=Date.now(),"load_start_time"===t&&delete o.load_end_time),"load_end_time"===t&&(o.title=e.title,o.icon_url=e.icon),chrome.storage.local.set({[a]:o})}console.log("bg run listener"),chrome.runtime.onMessage.addListener(((t,o,a)=>("pageLoadTime"===t.type?e(t.value,"load_start_time"):(async(e,t,o)=>{const a=await new Promise(((e,t)=>{chrome.tabs.query({active:!0,currentWindow:!0},(function(t){e(t.length?t[0].id:null)}))})),n={type:e,payload:t};try{chrome.tabs.sendMessage(a,n,{},o)}catch(e){console.warn(e),o(null)}})(t.type,"",a),async function(){const e=await new Promise(((e,t)=>{chrome.tabs.query({active:!1,currentWindow:!0},(function(t){e(t.length?t:null)}))}));e?e.forEach((e=>{const t=btoa(e.url.split("?")[0]);chrome.storage.local.get([t],(e=>{e[t]&&e[t].updated_at<Date.now()-864e6&&chrome.storage.local.remove(t)}))})):console.log("no tabs")}(),!0))),chrome.tabs.onUpdated.addListener((function(t,o,a){"complete"===o.status&&(console.log(a),e({time:Date.now(),url:a.url,title:a.title,icon:a.favIconUrl},"load_end_time"))}))})();