(()=>{"use strict";const t={tooltip:{show:!1,trigger:"item"},legend:{show:!1,type:"scroll",orient:"vertical",right:10,top:20,bottom:20},series:[{name:"Tag Dist",type:"pie",radius:["60%","100%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!0,position:"center"},emphasis:{label:{show:!0,fontSize:14,fontWeight:"bold"}},labelLine:{show:!1},data:[]}]},e={"Iframe Tags":"totalIframeTags","Meta Tags":"totalMetaTags","JS Tags":"totalScriptTags","CSS Tags":"totalCssTags"},a={tooltip:{trigger:"axis"},legend:{show:!0},grid:{left:"10%",right:"5%",top:"20%",bottom:"25%"},xAxis:{type:"category",boundaryGap:!1,data:[],axisLabel:{inside:!1,rotate:70,interval:0},axisTick:{show:!1},axisLine:{show:!1},z:10},yAxis:{type:"value"},series:[{name:"Iframe Tags",data:[],type:"line",smooth:!0,areaStyle:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#4e88ca"},{offset:1,color:"rgb(255,255,255,1)"}])}},{name:"Meta Tags",data:[],type:"line",smooth:!0,areaStyle:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#ebebeb"},{offset:1,color:"rgb(255,255,255,1)"}])}},{name:"JS Tags",data:[],type:"line",smooth:!0,areaStyle:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#b7e9ff"},{offset:1,color:"rgb(255,255,255,1)"}])}},{name:"CSS Tags",data:[],type:"line",smooth:!0,areaStyle:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#FFD700"},{offset:1,color:"rgb(255,255,255,1)"}])}}]},o=t=>{chrome.tabs.query({active:!0,currentWindow:!0},(function(e){const a=btoa(e[0].url.split("?")[0]);chrome.storage.local.get([a],(e=>{console.log("get storage data:",e),t(e[a])}))}))},s=async t=>{let e;const a=await chrome.tabs.query({active:!0,currentWindow:!0}),o=btoa(a[0].url.split("?")[0]),s=await chrome.storage.local.get([o]);if(void 0===s[o])e={url:a[0].url.split("?")[0],updated_at:Date.now(),value:[{updated_at:Date.now(),tabId:a[0].id,value:t}]};else{if(e=s[o],Date.now()-e.updated_at<1e3)return;e.updated_at=Date.now(),e.value.push({updated_at:Date.now(),tabId:a[0].id,value:t}),e.value.length>10&&e.value.shift()}chrome.storage.local.set({[o]:e})},n=(t,e,a)=>{const o={type:t,payload:e};chrome.runtime.sendMessage(o,{},a)};function r(){n("calc","message from popup",(e=>{e?(function(e){console.log("popup renderHtmlToPage",e);const a=$("#tagIframeCount"),o=$("#tagCount"),s=$("#tagMax"),n=$("#tagMetaCount"),r=$("#refJsCount"),i=$("#refCssCount"),l=$("#tagList"),c=$("#refreshTime");o.text(e.totalTags),s.text((e.tagList[0]||{key:"未知"}).key),a.text(e.totalIframeTags),n.text(e.totalMetaTags),r.text(e.totalScriptTags),i.text(e.totalCssTags);const g=e.tagList;l.text("");let d="";g.forEach(((t,e)=>{d+=`<div class="flex items-center justify-between style-list-item">\n    <div class="text-xs truncate">\n      ${t.key.toLowerCase()}\n    </div>\n    <div class="flex items-center text-xs font-bold">\n      ${t.value}\n    </div>\n  </div>`})),l.html(d);const u=document.getElementById("tagDist");u.removeAttribute("_echarts_instance_");const m=echarts.init(u);t.series[0].data=g.map((t=>({name:t.key,value:t.value}))),m.setOption(t),c.text((new Date).toLocaleString())}(e),s(e).then((()=>{o((t=>{const e=$("#load-time"),a=$("#icon-page"),o=$("#page-url"),s=$("#page-title");console.log(t),s.text(t.title||"page is loading ..."),s.attr("title",t.title),o.text(t.url||"page is loading ..."),o.attr("title",t.url),a.attr("src",t.icon_url),t.load_end_time?e.text((t.load_end_time-t.load_start_time)/1e3+" s"):e.text("page is loading ...")}))})).catch((t=>{console.log("set data error",t)}))):(console.log("response is null"),function(){const t=$("#tagIframeCount"),e=$("#tagCount"),a=$("#tagMax"),o=$("#tagMetaCount"),s=$("#refJsCount"),n=$("#refCssCount"),r=$("#tagList"),i=$("#refreshTime"),l=$("#tagDist");t.text("Error"),e.text("Error"),a.text("Error"),o.text("Error"),s.text("Error"),n.text("Error"),i.text("Please Reload Page").css("font-weight","bold"),r.html('<div class="style-content-empty flex items-center justify-center">\n  <span class="text-xs text-gray-500">No Data</span>\n  </div>'),l.html('<div class="style-content-empty flex items-center justify-center">\n  <span class="text-xs text-gray-500">No Data</span>\n  </div>')}())}))}function i(){n("checkAd","message from popup",(t=>{t?function(t){const e=$("#ad-overview");if(t&&t.length>0){e.text(`Found ${t.length} Ad Element${1===t.length?"":"s"}`);const a=$("#ad-list"),o=$("#ad-table");a.html(""),t.forEach(((t,e)=>{a.append(`\n      <tr>\n        <td>${t.tag}</td>\n        <td>${t.type}</td>\n        <td title='xpath: ${t.xpath}'>\n          <div style="word-break: break-all;">\n            ${t.value}\n          </div>\n        </td>\n      </tr>\n      `)})),o.show()}else e.text("No Ad Element Found ^_^")}(t):console.log("ads is null")}))}$((function(){console.log("popup starting1"),$("#refresh").on("click",(()=>{!function(){const t=$("#tagIframeCount"),e=$("#tagCount"),a=$("#tagMax"),o=$("#tagMetaCount"),s=$("#refJsCount"),n=$("#refCssCount"),r=$("#tagList"),i=$("#tagDist");t.text("Loading..."),e.text("Loading..."),a.text("Loading..."),o.text("Loading..."),s.text("Loading..."),n.text("Loading..."),r.html('<div class="style-content-empty flex items-center justify-center">\n  <span class="text-xs text-gray-500">Loading...</span>\n  </div>'),i.html('<div class="style-content-empty flex items-center justify-center">\n  <span class="text-xs text-gray-500">Loading...</span>\n  </div>')}(),r()})),$("#go-history").on("click",(()=>{$("#index").hide(),$("#history").show(),o((t=>{if(t){const o={...a};o.xAxis.data=t.value.map((t=>((t,e="yyyy-MM-dd HH:mm:ss")=>{if(!t)return"";let a=Number(t);!isNaN(a)&&String(a).length<13?a*=1e3:a=t;const o=new Date(a);function s(t){return t<10?`0${t}`:`${t}`}const n={yyyy:o.getFullYear(),M:o.getMonth()+1,MM:s(o.getMonth()+1),W:o.getDay(),WW:s(o.getDay()),d:o.getDate(),dd:s(o.getDate()),H:o.getHours(),HH:s(o.getHours()),h:o.getHours()>12?o.getHours()-12:o.getHours(),hh:parseInt(s(o.getHours()))>12?parseInt(s(o.getHours()))-12:s(o.getHours()),m:o.getMinutes(),mm:s(o.getMinutes()),s:o.getSeconds(),ss:s(o.getSeconds()),A:o.getHours()<12?"AM":"PM",a:o.getHours()<12?"am":"pm"};return(e.match(/[a-zA-Z]+/g)||[]).forEach((t=>{e=e.replace(t,n[t])})),e})(t.updated_at,"MM/dd HH:mm"))),t.value.forEach(((t,a)=>{o.series.map((a=>{a.data.push(t.value[e[a.name]]||0)}))}));const s=document.getElementById("history-chart");s.removeAttribute("_echarts_instance_"),echarts.init(s).setOption(o)}else console.log("no history")}))})),$("#go-index").on("click",(()=>{$("#history").hide(),$("#index").show()})),$("#ad-refresh").on("click",(()=>{i()})),r(),setTimeout((()=>{i()}),3e3)}))})();